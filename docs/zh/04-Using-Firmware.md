# 概念

## Amiibo

Amiibo是任天堂销售的游戏周边，通常呈现为一个游戏角色的手办，但也包括卡片、手腕带等其他形式。

每个Amiibo都在手办底座上嵌入了一个NFC标签。NFC标签在工厂预先记录了一些数据，用于识别手办的类型，使每个Amiibo与其他不同。
在一些游戏中（特别是任天堂发布的一方游戏）扫描NFC标签可以获得游戏中的道具等。

## Model Info

这是一个数字，用于描述Amiibo系列、游戏系列、角色和角色变体，此信息在首次编程后无法更改。

## Amiibo ID

用于识别Amiibo手办，手办序列号也是在工厂硬编码的，使得每一种手办都有自己的编号，且能通过Amiibo ID识别是哪一种手办。

## Amiibo Data

标签上的数据的这一部分存储了用户可修改的信息，如所有者和昵称的注册信息或游戏存档数据。

## NTAG215

NTAG215是NXP公司出售的一种NFC卡片，可以用来存储数据在卡片上。使用NFC读卡器可以读取或者写入NTAG215里面的数据。

Amiibo就是使用NTAG215卡片存储数据的。

## UID

为NTG215卡片的卡号。每个NTAG215都有一个7个字节的唯一的卡号。

在修改场景中，术语UID用于引用由Amiibo模拟器发送给游戏的UID，因为游戏使用UID来判断是否已经使用了Amiibo。如果模拟器更改了UID，模拟的Amiibo在游戏中看起来就像是完全不同的Amiibo，从而允许再次使用该Amiibo。

## key_retail.bin

这是一个包含任天堂用于加密Amiibo的私钥的二进制文件，是受版权保护的材料，因此您需要提供一个合法获取的文件，您可以从3DS或Switch主机中导出它。

## .BIN file

Amiibo的数据可以被导出到一个文件，该文件以.BIN扩展名存储了Amiibo原始内容的二进制转储。这些转储文件被上传到设备上供Amiibo模拟器应用程序或AmiiboLink模拟器应用程序使用。您需要提供一个合法获取的二进制转储文件。

通常大小是540字节，但是有些文件可能是不太常见的532字节或者572字节，但是`Amiibo模拟器`应用都能很好的使用。

## 多功能按钮

这是设备顶部的微型开关，是一个具有三个按钮的设备，一个“**中键**“和两个“**侧边**”按钮。将微型开关推向两侧会按下“侧边”按钮。按下微型开关时，会按下“中间”按钮。

在本文档中，按下多功能按钮的两侧被称为“**左键**”和”**右键**“，按下多功能按钮被称为“**中键**”；在菜单中导航项目时，使用侧面按钮，要选择一个项目，请按下”中间“按钮。长按”**中键**“超过1秒钟可以进入上下文菜单。

# 使用固件

Pixl.js固件的主屏幕分为几个应用程序，每个应用程序都可以运行以执行一些操作，主屏幕上的应用程序包括：

|                |
| -------------- |
|  Amiibo模拟器 |
|  Amiibo数据库 |
| ֍ AmiiboLink   |
|  卡模拟器     |
| ᛡᛒ 文件传输    |
|  Settings     |
|                |

---

# Amiibo模拟器

这个应用程序允许您浏览本地存储中的 .BIN 文件，并将它们用作当前的Amiibo。

您可以使用拇指滑轮滑动开关浏览文件夹和文件，推动到两侧可以更改元素，按下中间按钮可以选择突出显示的元素。

一旦选择了一个 .BIN 文件，其数据就会被用作当前的Amiibo，屏幕显示当前Amiibo的详细信息，如Amiibo当前UUID、文件名和Amiibo名称。

## Amiibo详情

您可以使用侧面按钮在当前文件夹中切换到下一个或上一个Amiibo。按下中间按钮，您可以更改当前Amiibo的行为，在子菜单中：

|                   |
| ----------------- |
| 随机生成          |
| 自动随机生成 [开] |
| 删除标签          |
| 返回详情          |
| 返回文件列表      |
| 返回主菜单        |
|                   |

- 随机生成：更改呈现给游戏的当前Amiibo的UID。新的UID会保持不变，直到您更改当前Amiibo或再次选择此选项。
- 自动随机生成：打开此功能将为当前Amiibo生成一个新的随机UID，每次游戏读取它时都会生成一个新的UID。这允许在具有限制的游戏中多次使用同一Amiibo。
- 删除标签：删除当前显示的标签
- 返回详情：返回当前详情页
- 返回文件列表：返回文件列表
- 返回主菜单：退出应用返回主菜单

_如果启用UID的随机生成（无论是手动还是自动），则在下一次加载该文件时将使用该文件的原始UID。_

## 文件浏览器

如果选择了一个文件，长按中键可以进入文件菜单。

|                |
| -------------- |
| 新建文件夹..   |
| 新建标签..     |
| 批量创建标签.. |
| 重命名..       |
| 删除..         |
| 返回文件列表   |
| 返回主菜单     |

### 新建文件夹

显示一个对话框输入文件夹名字在当前文件夹创建一个子文件夹。

### 新建标签..

在当前文件夹中创建一个空的Amiibo BIN文件。该.BIN文件现在类似于一个新的Ntag215，准备好被编程，您可以将该.BIN文件分配为当前Amiibo，并使用NFC编程器写入Amiibo数据，例如您可以使用手机上的iNFC或Tagmo，或者在3DS上使用Thenaya。如果编程的Amiibo在数据库中，.BIN文件甚至会被重命名为Amiibo的名称。

### 批量创建标签

在当前文件夹批量创建空的Amiibo BIN文件，点击之后会提示输入创建数量，创建amiibo的文件名为newXX.bin, XX为序号。

### 重命名

重命名选中的文件夹或者文件名。

### 删除

删除选中文件或者文件夹。如果是文件夹，则所有子文件夹和文件都会被删除。

### 返回文件列表

返回文件列表。

### 返回主菜单

退出应用返回主菜单。

> 从2.9.0开始，存储管理移入了设置菜单中。

---

# Amiibo数据库

TODO

---

# AmiiboLink

TODO

---

# 蓝牙传输

这个应用程序允许您连接iNFC或pixl.js网页，以管理设备存储上的文件或更新固件。

官方网页是 [https://pixl.amiibo.xyz/](https://pixl.amiibo.xyz/ "https://pixl.amiibo.xyz/.").

iNFC APP 是一个第三方应用程序。

进入此模式后，设备的蓝牙MAC地址和官方URL会显示在屏幕上。

也可以按左键或者右键展示二维码，用手机扫码即可快速打开网页。不过很遗憾，大部分手机都不支持通过浏览器连接蓝牙设备。

---

# 卡模拟器

这个应用可以用来模拟Mifare卡片和NTAG系列卡片。

Mifare卡片常见用于门禁卡，设备可以支持完整模拟Mifare类型的卡片。支持Mifare卡片类型有：

- Mifare Mini
- Mifare 1K
- Mifare 2K
- Mifare 4K

NTAG系列卡片常用于设备识别。支持的NTAG卡片类型有：

- NTAG 210
- NTAG 212
- NTAG 213
- NTAG 215
- NTAG 216
- Mifire Ultralight C
- Mifire Ultralight C
- Mifire Ultralight EV1(640 bits)
- Mifire Ultralight EV1(1312 bits)

目前总共支持存储8张卡片，后续开放自定义卡片数量。

> **注意**：<br/>
> NTAG系列的模拟功能还是测试中，功能还不太完善，未完全模拟NTAG125的特性。 <br />
> 后续会持续完善这一部分的功能。

只有在此界面才开启模拟功能，如果离开这个界面就会关闭模拟。

在磁盘格式化后或者第一次进入卡模拟器会初始化数据，这个过程可能需要几秒钟，请稍微等待下。

## 模拟卡界面

模拟页面的界面如下：

|                    |
| ------------------ |
| [01] de:ad:be:ef   |
|                   |
| < 卡槽 01 >        |
|                   |
| MF 1K <08/04 00>  |
|                    |

界面说明如下：

- 第一行：`01` 是卡片序号，`de:ad:be:ef`是卡号。
- 第二行：`卡槽 01`是当前卡的名字，可以自由设置
- 第三行：`MF 1K` 显示了卡类型，类型简写见下表，`08`是卡的SAK，`04 00`是卡的ATQA 最后一个符号是写入模式，如果是存储类型标记，则允许写入，否则不允许写入。如果当前卡片设置了默认卡片，设备会展示一个收藏图标作为提示。

| 显示    | 类型                             | 数据文件大小 |
| ------- | -------------------------------- | ------------ |
| MF mini | Mifare Mini                      | 320          |
| MF 1k   | Mifare 1K                        | 1024         |
| MF 2k   | Mifare 2K                        | 2048         |
| MF 4k   | Mifare 4K                        | 4096         |
| N210    | NTAG 210                         | 80           |
| N212    | NTAG 212                         | 164          |
| N213    | NTAG 213                         | 180          |
| N215    | NTAG 215                         | 540          |
| N216    | NTAG 216                         | 924          |
| MFUL    | Mifare Ultralight                | 64           |
| MFULC   | Mifare Ultralight C              | 144          |
| MFEV11  | Mifare Ultralight EV1(640 bits)  | 80           |
| MFEV21  | Mifare Ultralight EV1(1312 bits) | 164          |

# 主菜单

按中键可以进入主菜单。如下：
| |
| ------------ |
|  卡槽 [01]|
|  卡名 [卡槽 01]|
|  ID [de:ad:be:ef]|
|  卡类型 [MiFare 1K] |
|  默认卡片 [开] ｜
|  卡数据.. |
|  卡高级设置.. |
|  卡槽管理.. |
|  [标签详情] |
|  [主菜单] |
| |

- 卡槽: 显示了当前显示的卡槽，可以按中键选择卡槽
- 卡名：卡当前的名字，按中键可以进入设置卡名界面
- ID：显示了当前卡ID
- 卡类型：显示了当前卡类型
- 默认卡片：如果开启默认卡片，当设备从NFC场唤醒时，默认模拟这张卡。
- 卡数据：按中键可以进行卡数据管理
- 卡高级设置：按中键可以进入卡高级设置
- 卡槽管理：按中键进入卡槽管理界面，可以开启关闭卡槽
- [标签详情]：返回标签详情页面
- [主菜单]：退出此应用，进入主菜单

> **特别注意**：<br/>
> 部分的修改需要在退出到标签详情才会保存到存储，如果修改了部分配置，请务必进入到标签详情页面保存下。
> 如果开启的默认卡片功能，当设备从NFC场唤醒时，会调用卡模拟器应用，默认模拟这张卡。此功能和快速唤醒功能冲突，如果设置了默认卡，快速唤醒功能不再生效。

## 卡名修改

在此界面可以修改卡的名字。

由于显示区域有限，只能输入英文字符。

特别的，如果是中文字符，由于utf8编码的原因，删除请至少按2次才能完全删除。

如果想给卡片写中文备注，可以通过网页修改 `/chameleon/slots/00.bin`的备注来实现中文备注。<br />
00.bin为第一个卡槽文件，01.bin为第二个卡槽文件以此类推。

> 由于固件大小限制，目前仅有1000个左右的中文字符可以正常显示，如果输入中文没有显示，请提issue写上需要显示的字符，下一个版本可以加上特定的字符。

## 卡数据

在此界面可以执行卡片数据的导入导出。
| |
| ------------ |
|  加载.. |
|  导出.. |
|  重置.. |
| |

导入导出的文件都存在了 `/chameleon/dump/` 文件夹下。<br />
如需要导入数据，则需要提前通过网页把需要导入的数据文件写入到上面的文件夹。

- 加载：按中键可以进入加载界面，界面会读取`/chameleon/dump/`下面所有文件，按中键可以执行导入。
- 导出：按中键可以将当前的卡片导出到`/chameleon/dump/`文件夹下。
- 重置：按中键可以重置当前卡片数据为默认内置的空卡片数据。

> 加载的文件大小必须和当前卡类型完全一致才能导入。不同卡片的数据文件大小参考`模拟卡界面`表格。

## 卡高级设置

这个界面根据MiFare系列卡片和NTAG系列卡片显示不同的内容。

> **特别注意**：<br/>
> 这个界面是卡片模拟的高级设置，不建议普通用户修改，如要修改，请修改前请确定了解你在做什么再修改！<br/>
> 如果修改此部分导致卡片模拟失败，请先还原默认设置再试试。

### MiFare系列

|                    |
| ------------------ |
|  自定义模式 [关]  |
|  ID [de:ad:be:ef] |
|  SAK [08]         |
|  ATQA: [00 40]    |
|  Gen1A模式 [关]   |
|  Gen2模式 [关]    |
|  写入模式 [正常]  |
|  [返回]           |
|                    |

- 自定义模式：默认为关。关：ID卡识别阶段的ID/SAK/ATQA从卡片数据的0扇区读取，开：可以在下面ID/SAK/ATQA菜单设置独立的资源。
- ID: 显示当前卡ID。如果自定义模式为开，按中键可以进入输入界面修改。自定义模式为关，按中键不生效。
- SAK: 显示当前卡SAK。如果自定义模式为开，按中键可以进入输入界面修改。自定义模式为关，按中键不生效。
- ATQA：显示当前卡ATQA。如果自定义模式为开，按中键可以进入输入界面修改。自定义模式为关，按中键不生效。
- Gen1A模式：默认为关。开启后，允许模拟器响应国产高级后门指令。这些后门指令可以直接解锁卡，而无需密钥。
- Gen2模式：默认为关。开启后，允许写入0扇区。 (0扇区主要存放了ID/SAK/ATQA这些信息，允许写入则可以修改卡片的ID)
- 写入模式：默认为正常。可以有4个值，见下表。

| 写入模式 | 说明                                     |
| -------- | ---------------------------------------- |
| 正常     | 数据正常写入到内存，切换卡或者退出保存   |
| 拒绝     | 写入任何操作返回失败                     |
| 忽略     | 写入操作返回成功，但是不写入内存也不保存 |
| 缓存     | 数据正常写入内存，切换卡或者退出不保存   |

> Gen1A模式和Gen2模式建议在复制卡时候打开，复制完卡后关闭，避免被读卡器识别为克隆卡。

### NTAG系列

|                             |
| --------------------------- |
|  ID [04:68:95:71:fa:5c:64] |
|  SAK [00]                  |
|  ATQA: [00 44]             |
|  生成UID                   |
|  [返回]                    |
|                             |

- ID: 显示当前卡ID。不可编辑。
- SAK: 显示当前卡SAK。不可编辑。
- ATQA：显示当前卡ATQA。不可编辑。
- 生成UID：按中键可以随机生成一个新的ID，注意需要返回模拟界面才能模拟和保存新的卡片ID。

## 卡槽管理

这个界面显示所有卡槽的启用状态，可以单独开启和关闭卡槽。

|                  |
| ---------------- |
|  卡槽数量.. [8] |
|  卡槽 01 [开]   |
|  卡槽 02 [开]   |
|  ..             |
|  [返回]         |
|                  |

- 卡槽数量: 显示当前卡槽数量，默认为8，暂不支持修改数量，后续固件开放。
- 卡槽 xx: 显示卡槽开启关闭状态，按中键可以切换开启和关闭状态。

# 游戏

目前基于 [wagiminator/CH32V003-GameConsole](https://github.com/wagiminator/CH32V003-GameConsole) 移植了4个游戏。
这四个游戏如下：

- 复仇者
- 星球着陆
- 打砖块
- 俄罗斯方块

长按中键可以退出游戏。

更多信息请参考原仓库 [https://github.com/wagiminator/CH32V003-GameConsole](https://github.com/wagiminator/CH32V003-GameConsole "https://github.com/wagiminator/CH32V003-GameConsole.").

# 设置

TODO
